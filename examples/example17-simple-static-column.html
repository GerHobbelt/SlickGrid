<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>SlickGrid example 17: Simple static column</title>
  <link rel="stylesheet" href="../css/smoothness/jquery-ui-1.8.16.custom.css" type="text/css"/>
  <link rel="stylesheet" href="../slick.grid.css" type="text/css"/>
  <link rel="stylesheet" href="examples.css" type="text/css"/>
  <style>
    .slick-cell.copied {
      background: blue;
      background: rgba(0, 0, 255, 0.2);
      -webkit-transition: 0.5s background;
    }
  </style>
</head>
<body>
<div style="position:relative">
  <div class="grid-outer-wrapper">
    <div class="grid-header">
      <label>SlickGrid</label>
      <span style="float:right" class="ui-icon ui-icon-search" title="Toggle search panel"
            onclick="toggleFilterRow()"></span>
    </div>
    <div id="myGrid" class="grid-inner-wrapper"></div>
  </div>

  <div class="options-panel">
    <h2>Demonstrates</h2>
      <ul>
      <li>Virtual scrolling on both rows and columns.</li>
      <li>Select a range of cells with a mouse</li>
      <li>Use Ctrl-C and Ctrl-V keyboard shortcuts to cut and paste cells</li>
      <li>Use Esc to cancel a copy and paste operation</li>
      <li>Edit the cell and select a cell range to paste the range</li>
      </ul>

    <h2>View Source:</h2>
      <ul>
          <li id="viewsource">View Source Code</li>
          <div id="displaycode"></div>
      </ul>
  </div>
</div>

<script src="../lib/firebugx.js"></script>

<script src="../lib/jquery.js"></script>
<script src="../lib/jquery-ui.js"></script>
<script src="../lib/threedubmedia/event.drag/jquery.event.drag.js"></script>

<script src="../slick.core.js"></script>
<script src="../plugins/slick.autotooltips.js"></script>
<script src="../plugins/slick.cellrangedecorator.js"></script>
<script src="../plugins/slick.cellrangeselector.js"></script>
<script src="../plugins/slick.cellcopymanager.js"></script>
<script src="../plugins/slick.cellselectionmodel.js"></script>
<script src="../slick.editors.js"></script>
<script src="../slick.grid.js"></script>

<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" ></script>
<script src="examples.showcode.js"></script>

<script id="script_tag_example" type="text/javascript">
var grid;
var data = [];
var options = {
    editable: true,
    enableAddRow: true,
    enableCellNavigation: true,
    asyncEditorLoading: false,
    autoEdit: false,
    forceFitColumns: false,  // set this to true will crash (due too much CPU load) inside jQuery inside the slickgrid headers .width() calculation loop.
    enableColumnReorder: false,
    fixedColumn: {id: 'num'}
};

var columns = [
  {
    id: "selector",
    name: "#",
    field: "num",
    width: 30
  }
];


var children = [];
for (var i = 0; i < 9; i++) {
    children.push({ 
      id: "cell" + i, 
      name: i, 
      field: i 
    });
}
columns.push({
    id: "Today",
    name: "Today",
    field: "Today",
    width: 160,
    editor: FormulaEditor,
    children: children
});

function toggleFilterRow() {
  grid.setTopPanelVisibility(!grid.getOptions().showTopPanel);
}

/***
 * A proof-of-concept cell editor with Excel-like range selection and insertion.
 */
function FormulaEditor(args) {
    var _self = this;
    var _editor = new Slick.Editors.Text(args);
    var _selector;

    $.extend(this, _editor);

    function init() {
        // register a plugin to select a range and append it to the textbox
        // since events are fired in reverse order (most recently added are executed first),
        // this will override other plugins like moverows or selection model and will
        // not require the grid to not be in the edit mode
        _selector = new Slick.CellRangeSelector();
        _selector.onCellRangeSelected.subscribe(_self.handleCellRangeSelected);
        args.grid.registerPlugin(_selector);
    }

    this.destroy = function () {
        _selector.onCellRangeSelected.unsubscribe(_self.handleCellRangeSelected);
        grid.unregisterPlugin(_selector);
        _editor.destroy();
    };

    this.handleCellRangeSelected = function (e, args) {
        _editor.setValue(
            _editor.getValue() +
                grid.getColumns()[args.range.fromCell].name +
                args.range.fromRow +
                ":" +
                grid.getColumns()[args.range.toCell].name +
                args.range.toRow
        );
    };


    init();
}


$(function() {
    for (var i = 0; i < 100; i++) {
        var d = (data[i] = {});
        d["num"] = i;
    }

    grid = new Slick.Grid("#myGrid", data, columns, options);

    grid.setSelectionModel(new Slick.CellSelectionModel());
    grid.registerPlugin(new Slick.AutoTooltips());

    /*var canvas= $('.slick-viewport .grid-canvas');
    var staticPanel = $('<div id="staticPanel" style="width: 50px; height: 1000px; background-color:red; margin-right:-50px; float:left; position:relative; z-index:1000;"></div>');
    staticPanel.append($('.grid-canvas .slick-cell .l0'));

    $('.slick-viewport').append(staticPanel, canvas);*/



    // set keyboard focus on the grid
    grid.getCanvasNode().focus();

    var copyManager = new Slick.CellCopyManager();
    grid.registerPlugin(copyManager);

    copyManager.onPasteCells.subscribe(function (e, args) {
        if (args.from.length !== 1 || args.to.length !== 1) {
            throw "This implementation only supports single range copy and paste operations";
        }

        var from = args.from[0];
        var to = args.to[0];
        var val;
        for (var i = 0; i <= from.toRow - from.fromRow; i++) {
            for (var j = 0; j <= from.toCell - from.fromCell; j++) {
                if (i <= to.toRow - to.fromRow && j <= to.toCell - to.fromCell) {
                    val = data[from.fromRow + i][columns[from.fromCell + j].field];
                    data[to.fromRow + i][columns[to.fromCell + j].field] = val;
                    grid.invalidateRow(to.fromRow + i);
                }
            }
        }
        grid.render();
    });

    grid.onAddNewRow.subscribe(function (e, args) {
        var item = args.item;
        var column = args.column;
        grid.invalidateRow(data.length);
        data.push(item);
        grid.updateRowCount();
        grid.render();
    });
});
</script>
</body>
</html>
